{# vendor_invoice/reconcile.html.twig #}
<div class="row">
  
  {# Left: Invoice #}
  <div class="col-md-4">
    <div class="card">
      <div class="card-header bg-primary text-white">
        <h5>Invoice {{ invoice.invoiceNumber }}</h5>
      </div>
      <div class="card-body">
        <table class="table table-sm">
          {% for item in invoice.items %}
          <tr>
            <td>{{ item.description }}</td>
            <td>{{ item.quantity }}</td>
            <td>${{ item.unitPrice }}</td>
          </tr>
          {% endfor %}
        </table>
        <div class="mt-3 text-end">
          <strong>Total: ${{ invoice.totalAmount }}</strong>
        </div>
      </div>
    </div>
  </div>
  
  {# Middle: Receipts #}
  <div class="col-md-4">
    <div class="card">
      <div class="card-header bg-success text-white">
        <h5>Stock Receipts</h5>
      </div>
      <div class="card-body">
        {% for receipt in receipts %}
        <h6>{{ receipt.receiptNumber }} - {{ receipt.receivedAt|date('M d') }}</h6>
        <table class="table table-sm">
          {% for item in receipt.items %}
          <tr>
            <td>{{ item.stockTarget.name }}</td>
            <td>{{ item.qtyReceived }}</td>
            <td>${{ item.unitCost }}</td>
          </tr>
          {% endfor %}
        </table>
        {% endfor %}
        <div class="mt-3 text-end">
          <strong>Total Received: ${{ receiptTotal }}</strong>
        </div>
      </div>
    </div>
  </div>
  
  {# Right: Purchase Order #}
  <div class="col-md-4">
    <div class="card">
      <div class="card-header bg-info text-white">
        <h5>PO {{ purchase.poNumber }}</h5>
      </div>
      <div class="card-body">
        <table class="table table-sm">
          {% for item in purchase.items %}
          <tr>
            <td>{{ item.stockTarget.name }}</td>
            <td>{{ item.qtyOrdered }}</td>
            <td>${{ item.unitPrice }}</td>
          </tr>
          {% endfor %}
        </table>
        <div class="mt-3 text-end">
          <strong>Total Ordered: ${{ purchase.totalAmount }}</strong>
        </div>
      </div>
    </div>
  </div>
  
</div>

{# Variance Summary #}
<div class="card mt-4">
  <div class="card-header">
    <h5>Three-Way Match Summary</h5>
  </div>
  <div class="card-body">
    <table class="table">
      <thead>
        <tr>
          <th>Item</th>
          <th>PO Qty</th>
          <th>Received Qty</th>
          <th>Invoiced Qty</th>
          <th>PO Price</th>
          <th>Invoice Price</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody>
        {% for match in threeWayMatches %}
        <tr class="{{ match.hasVariance ? 'table-warning' : '' }}">
          <td>{{ match.itemName }}</td>
          <td>{{ match.poQty }}</td>
          <td>{{ match.receivedQty }}</td>
          <td>{{ match.invoicedQty }}</td>
          <td>${{ match.poPrice }}</td>
          <td>${{ match.invoicePrice }}</td>
          <td>
            {% if match.hasVariance %}
              <span class="badge bg-warning">Variance</span>
            {% else %}
              <span class="badge bg-success">Match</span>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    
    <form method="post" action="{{ path('vendor_invoice_approve_variance', {id: invoice.id}) }}">
      <input type="hidden" name="_token" value="{{ csrf_token('approve_variance') }}">
      
      <div class="mb-3">
        <label>Variance Notes:</label>
        <textarea name="variance_notes" class="form-control" rows="3" required></textarea>
      </div>
      
      <button type="submit" class="btn btn-primary">
        Approve & Reconcile
      </button>
    </form>
  </div>
</div>